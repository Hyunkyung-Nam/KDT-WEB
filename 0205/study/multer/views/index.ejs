<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

        <title>multer</title>
    </head>
    <body>
        <fieldset>
            <legend>싱글파일 업로드</legend>
            <input type="file" name="userfile" id="userfile" /><br />
            <button type="button" onclick="singlefileUpload()">업로드</button>
        </fieldset>
        <fieldset>
            <legend>여러파일 한번에 업로드</legend>
            <input type="file" name="userfiles" id="userfiles" multiple /><br />
            <button type="button" onclick="arrayfileUpload()">업로드</button>
        </fieldset>
        <fieldset>
            <legend>여러파일 각각업로드</legend>
            <input type="file" id="user-files1" /><br />
            <input type="file" id="user-files2" /><br />
            <input type="file" id="user-files3" /><br />
            <button type="button" onclick="fieldfileUpload()">업로드</button>
        </fieldset>
        <br />
        <img class="result1" src="" style="width: 200px" />
        <img class="result2" src="" style="width: 200px" />
        <img class="result3" src="" style="width: 200px" />

        <script>
            const result1 = document.querySelector('.result1');

            function singlefileUpload() {
                const file = document.querySelector('#userfile');
                console.log(file.files[0]);

                const formData = new FormData();
                console.log(file.files[0]);
                formData.append('userfile', file.files[0]);
                axios({
                    method: 'post',
                    url: '/single',
                    data: formData,
                    headers: {
                        'Content-Type': 'multipart/form-data',
                    },
                }).then((res) => {
                    console.log(res);
                    result1.src = res.data.path;
                });
            }
            function arrayfileUpload() {
                //multiple한번에 보내는거 고민해보기..
                const file = document.querySelector('#userfiles');

                console.log(file);
                const formData = new FormData();
                for (let i = 0; i < file.files.length; i++) {
                    formData.append('userfiles', file.files[i]);
                }

                axios({
                    method: 'post',
                    url: '/array',
                    data: formData,
                    headers: {
                        'Content-Type': 'multipart/form-data',
                    },
                }).then((res) => {
                    console.log(res);
                    for (let i = 0; i < res.data.length; i++) {
                        const result = document.querySelector(`.result${i + 1}`);
                        result.src = res.data[i].path;
                    }
                });
            }
            function fieldfileUpload() {
                const formData = new FormData();

                for (let i = 1; i <= 3; i++) {
                    const file = document.querySelector(`#user-files${i}`);
                    formData.append(`user-files${i}`, file.files[0]);
                }

                console.log(formData);
                axios({
                    method: 'post',
                    url: '/fields',
                    data: formData,
                    headers: {
                        'Content-Type': 'multipart/form-data',
                    },
                }).then((res) => {
                    for (let i = 0; i < 3; i++) {
                        const result = document.querySelector(`.result${i + 1}`);
                        result.src = res.data[`user-files${i + 1}`][0].path;
                    }
                });
            }
        </script>
    </body>
</html>
